//pp_absf_int
//Peak pick spectrum to find biggest peak and integrate a set region either side of each peak 
// This version does absf of a region around the peak as well
// takes one argument: width of half the integral region, in ppm (uses 0.47ppm if no argument)
//just does one dataset - use serial for more
// and then collateintegrals

int numPeaks, i, nargs;
double  peakFreqPPM, peakIntensity, maxpsp, maxips, peakplus, peakminus;
double halfintegral=0.47; //ppm

nargs=i_argc - 2;
if ( nargs > 0 )
    {
    	 halfintegral = atof(i_argv[2]);
    }
FILE *fptr;
char intfile[PATH_MAX];
PP

numPeaks = readPeakList(PROCPATH(0));
maxips=0.0;
maxpsp=0.0;
for (i=0; i<numPeaks; i++)
    {
        peakIntensity = getPeakIntensity(i);
        peakFreqPPM    = getPeakFreqPPM(i);
        if (peakIntensity > maxips)
        {
            maxips = peakIntensity;
            maxpsp = peakFreqPPM;
        }
    }
freePeakList();

STOREPAR("ABSF1", maxpsp+5.0)
STOREPAR("ABSF2", maxpsp-5.0)
ABSF

strcpy (intfile,PROCPATH("intrng"));
fptr=fopen(intfile, "w");
if(fptr==NULL)
{
	
  Proc_err(DEF_ERR_OPT, "Cannot open intnrg file for writing");
  ABORT
}
peakplus=maxpsp+halfintegral;
peakminus=maxpsp-halfintegral;

fprintf(fptr,"P 0\n");
fprintf(fptr,"%lf %lf \n", peakplus, peakminus);
fclose(fptr); 
STOREPAR("CURPRIN","integrals.txt")
LI

QUIT